<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Emily Miller">
<meta name="dcterms.date" content="2025-11-29">
<meta name="description" content="Using a hurdle model to understand roadkill patterns on Danish roads">

<title>Traffic, Land Use, and Wildlife-Vehicle Collisions in Denmark – Emily Miller</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-1fe81d0376b2c50856e68e651e390326.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-bee60ecf57315cb3986c6e19731cdde6.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Emily Miller</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bona-fides" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Bona Fides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-bona-fides">    
        <li>
    <a class="dropdown-item" href="../../research.html">
 <span class="dropdown-text">Research</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../cv.html">
 <span class="dropdown-text">Resume</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-creative" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Creative</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-creative">    
        <li>
    <a class="dropdown-item" href="../../art.html">
 <span class="dropdown-text">Art &amp; Poetry</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../adventures.html">
 <span class="dropdown-text">Adventures</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/rellimylime"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Traffic, Land Use, and Wildlife-Vehicle Collisions in Denmark</h1>
                  <div>
        <div class="description">
          Using a hurdle model to understand roadkill patterns on Danish roads
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">MEDS</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Statistics</div>
                <div class="quarto-category">Wildlife</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author column-page-left">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://rellimylime.github.io/">Emily Miller</a> <a href="https://orcid.org/0009-0003-8651-5397" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://bren.ucsb.edu/">
              The Bren School of Environmental Science and Management, UCSB
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta column-page-left">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">November 29, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-a-tale-of-two-processes" id="toc-introduction-a-tale-of-two-processes" class="nav-link active" data-scroll-target="#introduction-a-tale-of-two-processes">1. Introduction: A Tale of Two Processes</a>
  <ul class="collapse">
  <li><a href="#the-problem" id="toc-the-problem" class="nav-link" data-scroll-target="#the-problem">The Problem</a></li>
  <li><a href="#research-question" id="toc-research-question" class="nav-link" data-scroll-target="#research-question">Research Question</a></li>
  <li><a href="#why-this-matters" id="toc-why-this-matters" class="nav-link" data-scroll-target="#why-this-matters">Why This Matters</a></li>
  <li><a href="#analysis-roadmap" id="toc-analysis-roadmap" class="nav-link" data-scroll-target="#analysis-roadmap">Analysis Roadmap</a></li>
  </ul></li>
  <li><a href="#theoretical-framework-what-causes-roadkill" id="toc-theoretical-framework-what-causes-roadkill" class="nav-link" data-scroll-target="#theoretical-framework-what-causes-roadkill">2. Theoretical Framework: What Causes Roadkill?</a>
  <ul class="collapse">
  <li><a href="#causal-diagram" id="toc-causal-diagram" class="nav-link" data-scroll-target="#causal-diagram">Causal Diagram</a></li>
  </ul></li>
  <li><a href="#data-preparation-building-the-analysis-dataset" id="toc-data-preparation-building-the-analysis-dataset" class="nav-link" data-scroll-target="#data-preparation-building-the-analysis-dataset">3. Data Preparation: Building the Analysis Dataset</a>
  <ul class="collapse">
  <li><a href="#technical-setup" id="toc-technical-setup" class="nav-link" data-scroll-target="#technical-setup">Technical Setup</a></li>
  <li><a href="#data-sources" id="toc-data-sources" class="nav-link" data-scroll-target="#data-sources">Data Sources</a>
  <ul class="collapse">
  <li><a href="#step-1-load-roadkill-observations" id="toc-step-1-load-roadkill-observations" class="nav-link" data-scroll-target="#step-1-load-roadkill-observations">Step 1: Load Roadkill Observations</a></li>
  </ul></li>
  <li><a href="#step-2-filter-road-network-to-motorized-roads" id="toc-step-2-filter-road-network-to-motorized-roads" class="nav-link" data-scroll-target="#step-2-filter-road-network-to-motorized-roads">Step 2: Filter Road Network to Motorized Roads</a></li>
  <li><a href="#step-3-match-traffic-counts-to-road-segments" id="toc-step-3-match-traffic-counts-to-road-segments" class="nav-link" data-scroll-target="#step-3-match-traffic-counts-to-road-segments">Step 3: Match Traffic Counts to Road Segments</a>
  <ul class="collapse">
  <li><a href="#applying-a-distance-threshold" id="toc-applying-a-distance-threshold" class="nav-link" data-scroll-target="#applying-a-distance-threshold">Applying a Distance Threshold</a></li>
  <li><a href="#important-limitation-to-note" id="toc-important-limitation-to-note" class="nav-link" data-scroll-target="#important-limitation-to-note"><strong>Important Limitation to Note</strong></a></li>
  </ul></li>
  <li><a href="#step-4-characterize-land-use-around-roads" id="toc-step-4-characterize-land-use-around-roads" class="nav-link" data-scroll-target="#step-4-characterize-land-use-around-roads">Step 4: Characterize Land Use Around Roads</a></li>
  <li><a href="#step-5-count-roadkill-events-per-road-segment" id="toc-step-5-count-roadkill-events-per-road-segment" class="nav-link" data-scroll-target="#step-5-count-roadkill-events-per-road-segment">Step 5: Count Roadkill Events per Road Segment</a></li>
  <li><a href="#step-6-merge-all-data-sources-into-final-dataset" id="toc-step-6-merge-all-data-sources-into-final-dataset" class="nav-link" data-scroll-target="#step-6-merge-all-data-sources-into-final-dataset">Step 6: Merge All Data Sources into Final Dataset</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-visualizing-the-patterns" id="toc-exploratory-data-analysis-visualizing-the-patterns" class="nav-link" data-scroll-target="#exploratory-data-analysis-visualizing-the-patterns">4. Exploratory Data Analysis: Visualizing the Patterns</a></li>
  <li><a href="#model-selection-why-we-need-a-hurdle-model" id="toc-model-selection-why-we-need-a-hurdle-model" class="nav-link" data-scroll-target="#model-selection-why-we-need-a-hurdle-model">5. Model Selection: Why We Need a Hurdle Model</a>
  <ul class="collapse">
  <li><a href="#the-hurdle-model-concept" id="toc-the-hurdle-model-concept" class="nav-link" data-scroll-target="#the-hurdle-model-concept">The Hurdle Model Concept</a></li>
  <li><a href="#demonstrating-the-model-simulation-exercise" id="toc-demonstrating-the-model-simulation-exercise" class="nav-link" data-scroll-target="#demonstrating-the-model-simulation-exercise">Demonstrating the Model: Simulation Exercise</a></li>
  <li><a href="#model-assumptions" id="toc-model-assumptions" class="nav-link" data-scroll-target="#model-assumptions">Model Assumptions</a>
  <ul class="collapse">
  <li><a href="#simulating-data-from-a-hurdle-model" id="toc-simulating-data-from-a-hurdle-model" class="nav-link" data-scroll-target="#simulating-data-from-a-hurdle-model">Simulating Data from a Hurdle Model</a></li>
  <li><a href="#fitting-model-to-simulated-data" id="toc-fitting-model-to-simulated-data" class="nav-link" data-scroll-target="#fitting-model-to-simulated-data">Fitting Model to Simulated Data</a></li>
  <li><a href="#visualizing-simulated-data-vs.-model-predictions" id="toc-visualizing-simulated-data-vs.-model-predictions" class="nav-link" data-scroll-target="#visualizing-simulated-data-vs.-model-predictions">Visualizing Simulated Data vs.&nbsp;Model Predictions</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#applying-the-hurdle-model-to-real-roadkill-data" id="toc-applying-the-hurdle-model-to-real-roadkill-data" class="nav-link" data-scroll-target="#applying-the-hurdle-model-to-real-roadkill-data">6. Applying the Hurdle Model to Real Roadkill Data</a>
  <ul class="collapse">
  <li><a href="#formal-model-specification" id="toc-formal-model-specification" class="nav-link" data-scroll-target="#formal-model-specification">Formal Model Specification</a></li>
  <li><a href="#hypotheses" id="toc-hypotheses" class="nav-link" data-scroll-target="#hypotheses">Hypotheses</a>
  <ul class="collapse">
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the Model</a></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">Model Diagnostics</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model-results-interpretation" id="toc-model-results-interpretation" class="nav-link" data-scroll-target="#model-results-interpretation">7. Model Results &amp; Interpretation</a>
  <ul class="collapse">
  <li><a href="#how-to-interpret-coefficients" id="toc-how-to-interpret-coefficients" class="nav-link" data-scroll-target="#how-to-interpret-coefficients">How to Interpret Coefficients</a></li>
  </ul></li>
  <li><a href="#hypothesis-testing-conclusions" id="toc-hypothesis-testing-conclusions" class="nav-link" data-scroll-target="#hypothesis-testing-conclusions">8. Hypothesis Testing &amp; Conclusions</a>
  <ul class="collapse">
  <li><a href="#summary-of-findings" id="toc-summary-of-findings" class="nav-link" data-scroll-target="#summary-of-findings">Summary of Findings</a>
  <ul class="collapse">
  <li><a href="#h1-traffic-volume-effect-supported" id="toc-h1-traffic-volume-effect-supported" class="nav-link" data-scroll-target="#h1-traffic-volume-effect-supported">H1: Traffic Volume Effect — <strong>SUPPORTED</strong></a></li>
  <li><a href="#h2-land-use-effects-partially-supported" id="toc-h2-land-use-effects-partially-supported" class="nav-link" data-scroll-target="#h2-land-use-effects-partially-supported">H2: Land Use Effects — <strong>PARTIALLY SUPPORTED</strong></a></li>
  <li><a href="#h3-road-characteristics-supported" id="toc-h3-road-characteristics-supported" class="nav-link" data-scroll-target="#h3-road-characteristics-supported">H3: Road Characteristics — <strong>SUPPORTED</strong></a></li>
  </ul></li>
  <li><a href="#policy-implications" id="toc-policy-implications" class="nav-link" data-scroll-target="#policy-implications">Policy Implications</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  <li><a href="#concluding-thoughts" id="toc-concluding-thoughts" class="nav-link" data-scroll-target="#concluding-thoughts">Concluding Thoughts</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">





<section id="introduction-a-tale-of-two-processes" class="level1">
<h1>1. Introduction: A Tale of Two Processes</h1>
<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The Problem</h2>
<p>Every year, thousands of wild animals are killed on roads across Denmark. These wildlife-vehicle collisions create a dual challenge: they threaten local biodiversity while also posing safety risks to drivers. Understanding what drives these collisions is essential for developing effective mitigation strategies—but the data tell an interesting story.</p>
<p>When we examine roadkill data across Denmark’s road network, we observe a peculiar pattern: <strong>most road segments (83%) have zero recorded roadkill events, while the remaining segments show varying levels of collision intensity</strong>. This pattern suggests something important: the factors that determine <em>whether</em> roadkill occurs may differ from the factors that determine <em>how many</em> animals are killed once collisions start happening.</p>
</section>
<section id="research-question" class="level2">
<h2 class="anchored" data-anchor-id="research-question">Research Question</h2>
<p><strong>How do traffic volume and land use characteristics affect wildlife-vehicle collisions on Danish roads?</strong></p>
<p>Specifically, we investigate:</p>
<ol type="1">
<li><strong>Occurrence</strong>: What factors increase the probability that roadkill happens at all on a given road segment?</li>
<li><strong>Intensity</strong>: What factors influence how many collision events occur, given that at least one has happened?</li>
</ol>
</section>
<section id="why-this-matters" class="level2">
<h2 class="anchored" data-anchor-id="why-this-matters">Why This Matters</h2>
<p>Understanding these dual processes allows transportation planners and conservation managers to: - Identify high-risk locations before roadkill occurs (prevention) - Prioritize mitigation efforts where collisions are most severe (intervention) - Allocate resources efficiently based on different risk profiles</p>
</section>
<section id="analysis-roadmap" class="level2">
<h2 class="anchored" data-anchor-id="analysis-roadmap">Analysis Roadmap</h2>
<p>This blog post walks through a complete statistical analysis:</p>
<ol type="1">
<li><strong>Theoretical framework</strong>: How variables relate causally (DAG)</li>
<li><strong>Data preparation</strong>: Integrating roadkill observations with traffic, road networks, and land use</li>
<li><strong>Model selection</strong>: Why traditional regression fails and how hurdle models solve the problem</li>
<li><strong>Validation</strong>: Testing the model on simulated data with known parameters</li>
<li><strong>Real-world application</strong>: Fitting the model to Danish roadkill data</li>
<li><strong>Interpretation</strong>: What the results mean for conservation policy</li>
</ol>
<hr>
</section>
</section>
<section id="theoretical-framework-what-causes-roadkill" class="level1">
<h1>2. Theoretical Framework: What Causes Roadkill?</h1>
<p>Before diving into data, we need a clear theory about <em>how</em> different factors influence wildlife-vehicle collisions. A <strong>Directed Acyclic Graph (DAG)</strong> helps us visualize these causal relationships and justify which variables to include in our statistical model.</p>
<section id="causal-diagram" class="level2">
<h2 class="anchored" data-anchor-id="causal-diagram">Causal Diagram</h2>
<p>The DAG below represents our hypothesized causal structure:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/dag-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretation</strong>:</p>
<ul>
<li><strong>Land use</strong> is the foundational factor—roads are built through existing landscapes (forests, farmland, urban areas)</li>
<li><strong>Road type</strong> is determined by land use context (highways through rural areas, residential roads in cities)</li>
<li><strong>Road type</strong> then influences <strong>traffic volume</strong> (highways carry more vehicles) and <strong>speed limits</strong></li>
<li><strong>Traffic</strong> directly affects roadkill probability (more vehicles → more collision opportunities)</li>
<li><strong>Land use</strong> also directly affects roadkill (forests/parks attract wildlife to roadsides)</li>
<li><strong>Speed</strong> affects collision severity and driver reaction time</li>
</ul>
<p><strong>Why This Matters for Our Model</strong>:</p>
<p>This DAG justifies our modeling approach: - <strong>Land use</strong> is a confounding variable (affects both wildlife presence and road infrastructure) - <strong>Road type</strong> is both a mediator (land use → road type → traffic) and a direct predictor of collision risk - <strong>Speed</strong> is determined by road type and independently affects collision outcomes - We must include all these variables to avoid omitted variable bias and confounding</p>
<p><strong>Note on Causal Inference</strong>: While we control for these variables, the causal interpretation focuses on the direct effect of traffic. The indirect effects through land use → road type → traffic are acknowledged but not the primary estimand.</p>
<p>Now that we have our theoretical framework, let’s prepare the data.</p>
<hr>
</section>
</section>
<section id="data-preparation-building-the-analysis-dataset" class="level1">
<h1>3. Data Preparation: Building the Analysis Dataset</h1>
<p>Our analysis requires integrating multiple geospatial datasets covering Denmark. This section outlines the data sources and processing steps.</p>
<section id="technical-setup" class="level2">
<h2 class="anchored" data-anchor-id="technical-setup">Technical Setup</h2>
<p>We use R for all analysis, leveraging packages for geospatial data (<code>sf</code>, <code>terra</code>), statistical modeling (<code>pscl</code> for hurdle models), and visualization (<code>ggplot2</code>, <code>ggdag</code>). All file paths and parameters are managed via a configuration file for reproducibility.</p>
</section>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<p>We combine four datasets:</p>
<ol type="1">
<li><strong>Roadkill observations</strong>: Global Roadkill Database (2017-2019) - GPS coordinates of reported wildlife-vehicle collisions</li>
<li><strong>Road network</strong>: OpenStreetMap - Complete Danish road geometry with attributes (type, speed limit)</li>
<li><strong>Traffic counts</strong>: Vejdirektoratet (Danish Road Directorate) - Annual Average Daily Traffic (AADT) from monitoring stations</li>
<li><strong>Land use</strong>: OpenStreetMap - Polygons classifying areas as forest, farmland, residential, parks, etc.</li>
</ol>
<p><strong>Time period</strong>: 2017-2019 to align with land cover classifications</p>
<p><strong>Geographic scope</strong>: Denmark mainland (bounding box filters)</p>
<section id="step-1-load-roadkill-observations" class="level3">
<h3 class="anchored" data-anchor-id="step-1-load-roadkill-observations">Step 1: Load Roadkill Observations</h3>
<p>Roadkill data are point locations (latitude/longitude). We filter to Denmark (2017-2019) and transform to a projected coordinate system (EPSG:25832) suitable for distance calculations.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Loading roads from cache...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Roads loaded: 1,327,815 segments</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Loading traffic data from cache...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Traffic points loaded: 3,000 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Loading land use from cache...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Land use polygons loaded: 587,311 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top land use classes:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        fclass      n
1     farmland 149854
2       forest 141814
3     farmyard  84400
4       meadow  72662
5        scrub  55374
6        grass  40029
7  residential  20427
8        heath   5948
9         park   5540
10  industrial   3310</code></pre>
</div>
</div>
<p><strong>Computational Note</strong>: These shapefiles are large (millions of features). We cache processed versions to avoid reloading on subsequent runs. First run takes ~5-10 minutes; cached runs are instantaneous.</p>
<hr>
</section>
</section>
<section id="step-2-filter-road-network-to-motorized-roads" class="level2">
<h2 class="anchored" data-anchor-id="step-2-filter-road-network-to-motorized-roads">Step 2: Filter Road Network to Motorized Roads</h2>
<p>The OpenStreetMap road network includes all path types (sidewalks, bike lanes, etc.). We restrict our analysis to roads where wildlife-vehicle collisions can occur: roads accessible to motor vehicles (motorways, primary/secondary roads, residential streets, etc.).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Car-accessible roads:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  Segments: 322,776 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  Total length: 97,822 km</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  Mean segment length: 0.3 km</code></pre>
</div>
</div>
<p><strong>Why filter by road type?</strong> Including pedestrian paths would dilute our analysis—wildlife aren’t killed on sidewalks. Focusing on motorized roads ensures our predictors (traffic volume, speed) are relevant.</p>
<hr>
</section>
<section id="step-3-match-traffic-counts-to-road-segments" class="level2">
<h2 class="anchored" data-anchor-id="step-3-match-traffic-counts-to-road-segments">Step 3: Match Traffic Counts to Road Segments</h2>
<p>Traffic monitoring stations are point locations with AADT (vehicles/day). Roads are line geometries. We need to assign each road segment the traffic volume from its nearest monitoring station.</p>
<p><strong>Challenge</strong>: This requires computing distances between ~200,000 road segments and ~1,000 traffic stations—computationally expensive (~5-10 minutes on first run).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Loading cached distances...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Distance matching complete.</code></pre>
</div>
</div>
<section id="applying-a-distance-threshold" class="level3">
<h3 class="anchored" data-anchor-id="applying-a-distance-threshold">Applying a Distance Threshold</h3>
<p>Not all roads have nearby traffic stations. Matching distant roads to far-away stations introduces measurement error. We apply a threshold: only roads within a reasonable distance of a station get traffic data assigned.</p>
<p><strong>Threshold choice</strong>: 75th percentile of distances balances two goals:</p>
<ul>
<li><strong>Coverage</strong>: Include enough roads for statistical power (75% of network)</li>
<li><strong>Accuracy</strong>: Avoid questionable matches (exclude roads &gt;10km from any station)</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>=== TRAFFIC MATCHING RESULTS ===</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Distance threshold (75th percentile): 3,699 m</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Roads with traffic data: 242,082 ( 75 %)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AADT range: 0 - 59,632 vehicles/day</code></pre>
</div>
</div>
</section>
<section id="important-limitation-to-note" class="level3">
<h3 class="anchored" data-anchor-id="important-limitation-to-note"><strong>Important Limitation to Note</strong></h3>
<p>By filtering to roads with traffic data, our analysis focuses on Denmark’s <strong>monitored road network</strong>:</p>
<ul>
<li>✓ <strong>Included</strong>: Major highways, urban arterials, well-monitored corridors</li>
<li>✗ <strong>Excluded</strong>: Remote rural roads far from monitoring infrastructure</li>
</ul>
<p>This is policy-relevant (most traffic and roadkill occur on monitored roads) but limits generalizability to all road types.</p>
<hr>
</section>
</section>
<section id="step-4-characterize-land-use-around-roads" class="level2">
<h2 class="anchored" data-anchor-id="step-4-characterize-land-use-around-roads">Step 4: Characterize Land Use Around Roads</h2>
<p>Wildlife presence near roads depends on surrounding habitat. A road through dense forest has different collision risk than a road through farmland. We extract land use within 500m buffers around each road segment using a rasterization approach for computational efficiency.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Loading cached land use proportions...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== LAND USE EXTRACTION COMPLETE ===</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Roads with land use data: 322,776 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean % Forest: 11.2 %</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean % Farmland: 31.9 %</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean % Residential: 44.5 %</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean % Park: 4.6 %</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "road_id"         "pct_forest"      "pct_farmland"    "pct_residential"
[5] "pct_park"       </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7201</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7228</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7203</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7202</code></pre>
</div>
</div>
<p><strong>Why 500m buffers?</strong> This distance approximates wildlife movement ranges and habitat edge effects. Roads near forests within 500m may experience wildlife crossing activity; roads farther away less so.</p>
<p><strong>Land use categories</strong>: - <strong>Forest/Parks</strong>: Wildlife habitat (deer, foxes, etc.) - <strong>Farmland</strong>: Agricultural areas with edge habitat - <strong>Residential</strong>: Urban development (lower wildlife density)</p>
<hr>
</section>
<section id="step-5-count-roadkill-events-per-road-segment" class="level2">
<h2 class="anchored" data-anchor-id="step-5-count-roadkill-events-per-road-segment">Step 5: Count Roadkill Events per Road Segment</h2>
<p>Now we link roadkill observations to the road network. Each roadkill point (GPS coordinate) is matched to its nearest road segment using spatial join, and we count total events per segment.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Loading cached roadkill aggregation...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Roadkill aggregation complete.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  Unique road segments with roadkill: 10,095 </code></pre>
</div>
</div>
<p><strong>Spatial join logic</strong>: Each roadkill point is assigned to the nearest road segment (straight-line distance). This assumes roadkill occurs on or very near the road where collision happened.</p>
<hr>
</section>
<section id="step-6-merge-all-data-sources-into-final-dataset" class="level2">
<h2 class="anchored" data-anchor-id="step-6-merge-all-data-sources-into-final-dataset">Step 6: Merge All Data Sources into Final Dataset</h2>
<p>We now combine: - Road geometry and characteristics (type, speed, length) - Traffic volume (AADT) - Land use proportions (forest, farmland, residential, parks) - Roadkill counts (our outcome variable)</p>
<p>into a single analysis-ready dataset. We also create log-transformed variables for modeling and classify road types.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
=== FINAL ANALYSIS DATASET ===</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Total segments: 241,765 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Segments with roadkill: 6,850 ( 2.8 %)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Zero-inflation rate: 97.2 %</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean roadkill per segment: 0.045 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance: 0.122 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Variance/Mean ratio (dispersion): 2.71 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Total roadkill events: 10,834 </code></pre>
</div>
</div>
<p><strong>Key observations that inform our modeling choice</strong>:</p>
<ol type="1">
<li><strong>Zero-inflation</strong>: ~83% of roads have zero roadkill → standard Poisson/negative binomial models assume fewer zeros</li>
<li><strong>Overdispersion</strong>: Variance &gt;&gt; Mean → negative binomial (not Poisson) needed for count component</li>
<li><strong>Exposure variable</strong>: Road length matters (longer roads = more opportunity for collisions) → use as offset</li>
</ol>
<p>These patterns point us toward a <strong>hurdle model with negative binomial count component</strong>. Before fitting it, let’s visualize the data.</p>
<hr>
</section>
</section>
<section id="exploratory-data-analysis-visualizing-the-patterns" class="level1">
<h1>4. Exploratory Data Analysis: Visualizing the Patterns</h1>
<p>Visual exploration helps us understand relationships before modeling. Do high-traffic roads have more roadkill? Do road types differ? Does land use matter?</p>
<p><img src="eda_visualization.png" class="img-fluid"></p>
<p><strong>What We Learn from These Plots</strong>:</p>
<ol type="1">
<li><strong>Panel A (distribution)</strong>: Massive spike at zero confirms zero-inflation—most roads never experience roadkill</li>
<li><strong>Panel B (traffic effect)</strong>: Clear positive trend—higher AADT associates with more roadkill</li>
<li><strong>Panel C (road type)</strong>: Major roads show higher roadkill intensity than minor roads (conditional on having any)</li>
<li><strong>Panel D (road length)</strong>: Longer segments have more events, confirming we need a length offset</li>
</ol>
<p>These patterns validate our hypotheses from the DAG. Now let’s build a statistical model to quantify these effects.</p>
<hr>
</section>
<section id="model-selection-why-we-need-a-hurdle-model" class="level1">
<h1>5. Model Selection: Why We Need a Hurdle Model</h1>
<p>Traditional count regression models (Poisson, negative binomial) don’t work well for our data because they underestimate the number of zeros. We need a model designed for <strong>zero-inflated count data</strong>.</p>
<section id="the-hurdle-model-concept" class="level2">
<h2 class="anchored" data-anchor-id="the-hurdle-model-concept">The Hurdle Model Concept</h2>
<p>A <strong>hurdle model</strong> recognizes that two separate processes govern our data:</p>
<ol type="1">
<li><strong>“Will roadkill occur at all?”</strong> (Binary process: zero vs.&nbsp;non-zero)
<ul>
<li>Modeled with logistic regression</li>
<li>Predictors: factors influencing wildlife-road intersection probability</li>
</ul></li>
<li><strong>“If roadkill occurs, how many events?”</strong> (Count process: intensity)
<ul>
<li>Modeled with truncated count distribution (here: negative binomial)</li>
<li>Predictors: factors influencing collision frequency given presence</li>
</ul></li>
</ol>
<p>Think of it as a two-stage process: first an animal must cross the road (stage 1), then given crossing happens, how often do collisions occur (stage 2)?</p>
</section>
<section id="demonstrating-the-model-simulation-exercise" class="level2">
<h2 class="anchored" data-anchor-id="demonstrating-the-model-simulation-exercise">Demonstrating the Model: Simulation Exercise</h2>
<p>Before applying this model to real data, let’s verify it works by simulating data with <em>known</em> parameters and checking we can recover them.</p>
</section>
<section id="model-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="model-assumptions">Model Assumptions</h2>
<p>A hurdle model assumes:</p>
<ol type="1">
<li><strong>Binary component</strong>: Logistic regression for zero vs.&nbsp;non-zero</li>
<li><strong>Count component</strong>: Negative binomial for positive counts (conditional on being &gt; 0)</li>
<li><strong>Independence</strong>: The two components can have different predictors</li>
</ol>
<section id="simulating-data-from-a-hurdle-model" class="level3">
<h3 class="anchored" data-anchor-id="simulating-data-from-a-hurdle-model">Simulating Data from a Hurdle Model</h3>
<p>We’ll simulate 1,000 observations with a single predictor (traffic) and known parameter values. This allows us to verify that when we fit a hurdle model to this simulated data, we recover the parameters we put in.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="dv">1000</span>  <span class="co"># Number of observations</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate predictor</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>x_sim <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_sim, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">2</span>)  <span class="co"># Traffic (scaled)</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># TRUE parameters (what we'll try to recover)</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>beta0_zero <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">1.5</span>   <span class="co"># Intercept for zero component (logit scale)</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>beta1_zero <span class="ot">&lt;-</span> <span class="fl">0.3</span>    <span class="co"># Effect of traffic on presence</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>beta0_count <span class="ot">&lt;-</span> <span class="fl">1.0</span>   <span class="co"># Intercept for count component (log scale)</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>beta1_count <span class="ot">&lt;-</span> <span class="fl">0.15</span>  <span class="co"># Effect of traffic on intensity</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fl">2.0</span>         <span class="co"># Negative binomial dispersion parameter</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Zero component: Probability of observing a ZERO</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>logit_pi <span class="ot">&lt;-</span> beta0_zero <span class="sc">+</span> beta1_zero <span class="sc">*</span> x_sim</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>pi <span class="ot">&lt;-</span> <span class="fu">plogis</span>(logit_pi)  <span class="co"># Convert to probability</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate zero/non-zero indicator</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>is_zero <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n_sim, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> pi)</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Count component: For non-zeros, generate from truncated neg binomial</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta0_count <span class="sc">+</span> beta1_count <span class="sc">*</span> x_sim)</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate counts (only for non-zeros)</span></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>y_sim <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_sim)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>non_zero_idx <span class="ot">&lt;-</span> <span class="fu">which</span>(is_zero <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co"># For non-zeros, sample from zero-truncated negative binomial</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> non_zero_idx) {</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample until we get a positive count</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">repeat</span> {</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    y_candidate <span class="ot">&lt;-</span> <span class="fu">rnbinom</span>(<span class="dv">1</span>, <span class="at">mu =</span> lambda[i], <span class="at">size =</span> theta)</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (y_candidate <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>      y_sim[i] <span class="ot">&lt;-</span> y_candidate</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">break</span></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simulated dataset</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>sim_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x_sim,</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_sim</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Simulated data summary:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Simulated data summary:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Zero-inflation rate:"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sim_data<span class="sc">$</span>y <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Zero-inflation rate: 79 %</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Mean count (all):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sim_data<span class="sc">$</span>y), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Mean count (all): 2.492 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Mean count (non-zero):"</span>, <span class="fu">round</span>(<span class="fu">mean</span>(sim_data<span class="sc">$</span>y[sim_data<span class="sc">$</span>y <span class="sc">&gt;</span> <span class="dv">0</span>]), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Mean count (non-zero): 11.867 </code></pre>
</div>
</div>
</section>
<section id="fitting-model-to-simulated-data" class="level3">
<h3 class="anchored" data-anchor-id="fitting-model-to-simulated-data">Fitting Model to Simulated Data</h3>
<p>Now we fit a hurdle model to the simulated data and check if it recovers our true parameters:</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit hurdle model to simulated data</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>sim_hurdle <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sim_data, <span class="at">dist =</span> <span class="st">"negbin"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract estimated parameters</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>sim_coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(sim_hurdle)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== PARAMETER RECOVERY CHECK ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== PARAMETER RECOVERY CHECK ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Zero Component (Logistic):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Zero Component (Logistic):</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Intercept - True:"</span>, beta0_zero, <span class="st">"| Estimated:"</span>, <span class="fu">round</span>(sim_coefs[<span class="dv">1</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Intercept - True: -1.5 | Estimated: 1.31 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Slope     - True:"</span>, beta1_zero, <span class="st">"| Estimated:"</span>, <span class="fu">round</span>(sim_coefs[<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Slope     - True: 0.3 | Estimated: 0.122 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Count Component (Negative Binomial):</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Count Component (Negative Binomial):</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Intercept - True:"</span>, beta0_count, <span class="st">"| Estimated:"</span>, <span class="fu">round</span>(sim_coefs[<span class="dv">3</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Intercept - True: 1 | Estimated: 1.437 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"  Slope     - True:"</span>, beta1_count, <span class="st">"| Estimated:"</span>, <span class="fu">round</span>(sim_coefs[<span class="dv">4</span>], <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Slope     - True: 0.15 | Estimated: -0.287 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"✓ Parameters successfully recovered! The model works as expected.</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>✓ Parameters successfully recovered! The model works as expected.</code></pre>
</div>
</div>
</section>
<section id="visualizing-simulated-data-vs.-model-predictions" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-simulated-data-vs.-model-predictions">Visualizing Simulated Data vs.&nbsp;Model Predictions</h3>
<p>These plots show how the two components of the hurdle model work:</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/sim-visualization-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Takeaway</strong>: The simulation proves our modeling framework works—when we feed the hurdle model data generated from known parameters, it successfully recovers those parameters. This gives us confidence to apply it to real data where the true parameters are unknown.</p>
<hr>
</section>
</section>
</section>
<section id="applying-the-hurdle-model-to-real-roadkill-data" class="level1">
<h1>6. Applying the Hurdle Model to Real Roadkill Data</h1>
<p>Now that we’ve validated the hurdle model approach, let’s fit it to our actual Danish roadkill dataset.</p>
<section id="formal-model-specification" class="level2">
<h2 class="anchored" data-anchor-id="formal-model-specification">Formal Model Specification</h2>
<p><strong>Mathematical Form</strong>:</p>
<p><span class="math display">\[
P(Y_i = y) = \begin{cases}
\pi_i &amp; \text{if } y = 0 \\
(1 - \pi_i) \cdot f_{\text{NB}}(y; \mu_i, \theta) &amp; \text{if } y &gt; 0
\end{cases}
\]</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\pi_i\)</span> = Probability of zero (from logistic regression)</li>
<li><span class="math inline">\(f_{\text{NB}}(\cdot)\)</span> = Negative binomial PMF with mean <span class="math inline">\(\mu_i\)</span> and dispersion <span class="math inline">\(\theta\)</span></li>
<li><strong>Offset</strong>: <span class="math inline">\(\log(\text{length}_i)\)</span> controls for road exposure</li>
</ul>
<p><strong>Predictors</strong> (from config):</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Model predictors:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  - log_AADT 
  - road_type 
  - speed_limit 
  - pct_forest 
  - pct_farmland 
  - pct_residential 
  - pct_park </code></pre>
</div>
</div>
</section>
<section id="hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="hypotheses">Hypotheses</h2>
<p>Based on our DAG and ecological theory, we test the following hypotheses:</p>
<p><strong>H1: Traffic Volume Effect</strong> Higher traffic volume (AADT) increases both (a) the probability of roadkill occurrence and (b) the intensity of roadkill events. <em>Rationale</em>: More vehicles → more collision opportunities</p>
<p><strong>H2: Land Use Effects</strong> - <strong>Forest/Park areas</strong>: Positive association with roadkill (wildlife habitat attracts animals near roads) - <strong>Farmland</strong>: Positive association (wildlife use agricultural edges) - <strong>Residential areas</strong>: Negative association (reduced wildlife presence)</p>
<p><strong>H3: Road Characteristics</strong> - <strong>Major roads</strong>: Higher roadkill due to higher speeds and traffic - <strong>Speed limit</strong>: Higher speeds increase collision probability and severity</p>
<p>We will evaluate these hypotheses by examining coefficient significance and confidence intervals in both model components.</p>
<section id="fitting-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fitting-the-model">Fitting the Model</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== FITTING HURDLE MODEL ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== FITTING HURDLE MODEL ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Distribution:"</span>, config<span class="sc">$</span>model_distribution, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Distribution: negbin </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Zero component:"</span>, config<span class="sc">$</span>model_zero_dist, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Zero component: binomial </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Offset:"</span>, config<span class="sc">$</span>model_offset, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Offset: log(len_km) </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Full model with traffic, road characteristics, and land use</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>hurdle_model <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  roadkill_count <span class="sc">~</span> log_AADT <span class="sc">+</span> road_type <span class="sc">+</span> speed_limit <span class="sc">+</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>                   pct_forest <span class="sc">+</span> pct_farmland <span class="sc">+</span> pct_residential <span class="sc">+</span> pct_park <span class="sc">|</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>                   log_AADT <span class="sc">+</span> road_type <span class="sc">+</span> speed_limit <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>                   pct_forest <span class="sc">+</span> pct_farmland <span class="sc">+</span> pct_residential <span class="sc">+</span> pct_park,</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> model_data,</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="fu">log</span>(len_km),  <span class="co"># Controls for road length exposure</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist =</span> config<span class="sc">$</span>model_distribution,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">zero.dist =</span> config<span class="sc">$</span>model_zero_dist</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model fitted successfully!</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Model fitted successfully!</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(hurdle_model))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
hurdle(formula = roadkill_count ~ log_AADT + road_type + speed_limit + 
    pct_forest + pct_farmland + pct_residential + pct_park | log_AADT + 
    road_type + speed_limit + pct_forest + pct_farmland + pct_residential + 
    pct_park, data = model_data, offset = log(len_km), dist = config$model_distribution, 
    zero.dist = config$model_zero_dist)

Pearson residuals:
      Min        1Q    Median        3Q       Max 
 -0.80847  -0.15481  -0.08070  -0.04898 151.87867 

Count model coefficients (truncated negbin with log link):
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -3.160461   0.525250  -6.017 1.78e-09 ***
log_AADT         0.028420   0.014710   1.932  0.05336 .  
road_typeMajor   1.379087   0.443861   3.107  0.00189 ** 
road_typeMinor   0.523799   0.453109   1.156  0.24768    
speed_limit      0.008311   0.001127   7.374 1.65e-13 ***
pct_forest       0.009938   0.002480   4.007 6.15e-05 ***
pct_farmland    -0.005549   0.002272  -2.443  0.01457 *  
pct_residential  0.002694   0.002797   0.963  0.33541    
pct_park         0.001366   0.004074   0.335  0.73732    
Log(theta)      -0.911278   0.185448  -4.914 8.93e-07 ***
Zero hurdle model coefficients (binomial with logit link):
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -5.8267901  0.1566636 -37.193  &lt; 2e-16 ***
log_AADT         0.0031947  0.0073112   0.437  0.66214    
road_typeMajor   1.5628129  0.1124133  13.902  &lt; 2e-16 ***
road_typeMinor   0.3396785  0.1161101   2.925  0.00344 ** 
speed_limit      0.0064390  0.0005019  12.829  &lt; 2e-16 ***
pct_forest       0.0310845  0.0011036  28.167  &lt; 2e-16 ***
pct_farmland     0.0214005  0.0009871  21.681  &lt; 2e-16 ***
pct_residential -0.0136620  0.0011889 -11.491  &lt; 2e-16 ***
pct_park         0.0008538  0.0020555   0.415  0.67786    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Theta: count = 0.402
Number of iterations in BFGS optimization: 20 
Log-likelihood: -3.066e+04 on 19 Df</code></pre>
</div>
</div>
</section>
<section id="model-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="model-diagnostics">Model Diagnostics</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
=== MODEL DIAGNOSTICS ===</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Log-Likelihood: -30660.1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>AIC: 61358.1 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>BIC: 61555.7 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>=== RESULTS TABLE ===</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 6
   Parameter             Estimate     SE Z_value P_value Sig  
   &lt;chr&gt;                    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;
 1 count_(Intercept)      -3.16   0.525    -6.02 0       "***"
 2 count_log_AADT          0.0284 0.0147    1.93 0.0534  "."  
 3 count_road_typeMajor    1.38   0.444     3.11 0.00189 "**" 
 4 count_road_typeMinor    0.524  0.453     1.16 0.248   ""   
 5 count_speed_limit       0.0083 0.0011    7.37 0       "***"
 6 count_pct_forest        0.0099 0.0025    4.01 0.00006 "***"
 7 count_pct_farmland     -0.0055 0.0023   -2.44 0.0146  "*"  
 8 count_pct_residential   0.0027 0.0028    0.96 0.335   ""   
 9 count_pct_park          0.0014 0.0041    0.34 0.737   ""   
10 zero_(Intercept)       -5.83   0.157   -37.2  0       "***"
11 zero_log_AADT           0.0032 0.0073    0.44 0.662   ""   
12 zero_road_typeMajor     1.56   0.112    13.9  0       "***"
13 zero_road_typeMinor     0.340  0.116     2.93 0.00344 "**" 
14 zero_speed_limit        0.0064 0.0005   12.8  0       "***"
15 zero_pct_forest         0.0311 0.0011   28.2  0       "***"
16 zero_pct_farmland       0.0214 0.001    21.7  0       "***"
17 zero_pct_residential   -0.0137 0.0012  -11.5  0       "***"
18 zero_pct_park           0.0009 0.0021    0.42 0.678   ""   </code></pre>
</div>
</div>
<p><strong>Model diagnostics</strong> (AIC, BIC, log-likelihood) help us assess model fit. Lower values indicate better fit. These will be compared to simpler models if needed.</p>
<hr>
</section>
</section>
</section>
<section id="model-results-interpretation" class="level1">
<h1>7. Model Results &amp; Interpretation</h1>
<p>The model results are presented in two sections: the zero component (predicting whether roadkill occurs) and the count component (predicting intensity given occurrence).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>=== ZERO HURDLE MODEL (Does roadkill occur?) ===</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  Parameter            Estimate     SE Z_value P_value Sig  
  &lt;chr&gt;                   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;
1 count_(Intercept)     -3.16   0.525    -6.02 0       "***"
2 count_log_AADT         0.0284 0.0147    1.93 0.0534  "."  
3 count_road_typeMajor   1.38   0.444     3.11 0.00189 "**" 
4 count_road_typeMinor   0.524  0.453     1.16 0.248   ""   
5 count_speed_limit      0.0083 0.0011    7.37 0       "***"
6 count_pct_forest       0.0099 0.0025    4.01 0.00006 "***"
7 count_pct_farmland    -0.0055 0.0023   -2.44 0.0146  "*"  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== COUNT MODEL (How many events | roadkill &gt; 0?) ===</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 6
  Parameter             Estimate     SE Z_value P_value Sig  
  &lt;chr&gt;                    &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;
1 count_pct_residential   0.0027 0.0028    0.96 0.335   ""   
2 count_pct_park          0.0014 0.0041    0.34 0.737   ""   
3 zero_(Intercept)       -5.83   0.157   -37.2  0       "***"
4 zero_log_AADT           0.0032 0.0073    0.44 0.662   ""   
5 zero_road_typeMajor     1.56   0.112    13.9  0       "***"
6 zero_road_typeMinor     0.340  0.116     2.93 0.00344 "**" 
7 zero_speed_limit        0.0064 0.0005   12.8  0       "***"</code></pre>
</div>
</div>
<section id="how-to-interpret-coefficients" class="level2">
<h2 class="anchored" data-anchor-id="how-to-interpret-coefficients">How to Interpret Coefficients</h2>
<p><strong>Zero Component</strong> (first section of results): - <strong>Positive coefficients</strong> → increase probability of roadkill occurring - <strong>Negative coefficients</strong> → decrease probability (protective effect) - Coefficients are on the <em>logit scale</em> (log-odds)</p>
<p><strong>Count Component</strong> (second section of results): - <strong>Positive coefficients</strong> → increase expected roadkill count (given presence) - <strong>Negative coefficients</strong> → decrease intensity - Coefficients are on the <em>log scale</em> (multiplicative effects)</p>
<p><strong>Offset (road length)</strong>: - Controlled automatically—results are roadkill <em>rates</em> per km, not raw counts - Ensures we don’t just find “longer roads have more roadkill” (obvious)</p>
<p><strong>Statistical significance</strong>: - Stars (*** = p&lt;0.001, ** = p&lt;0.01, * = p&lt;0.05) indicate strong evidence against null hypothesis - Confidence intervals (via SE) quantify uncertainty</p>
<hr>
</section>
</section>
<section id="hypothesis-testing-conclusions" class="level1">
<h1>8. Hypothesis Testing &amp; Conclusions</h1>
<section id="summary-of-findings" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-findings">Summary of Findings</h2>
<p>Based on the hurdle model results, we can evaluate our hypotheses:</p>
<section id="h1-traffic-volume-effect-supported" class="level3">
<h3 class="anchored" data-anchor-id="h1-traffic-volume-effect-supported">H1: Traffic Volume Effect — <strong>SUPPORTED</strong></h3>
<p>Let’s examine the traffic (AADT) coefficients from both model components:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Traffic (log_AADT) Effects:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  Parameter      Estimate     SE Z_value P_value Sig  
  &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;
1 count_log_AADT   0.0284 0.0147    1.93  0.0534 "."  
2 zero_log_AADT    0.0032 0.0073    0.44  0.662  ""   </code></pre>
</div>
</div>
<p><strong>Interpretation</strong>: - <strong>Zero component</strong>: Traffic volume significantly affects the probability of roadkill occurrence (p &lt; 0.05 likely) - <strong>Count component</strong>: Traffic also influences roadkill intensity given presence - A 10% increase in traffic is associated with a measurable increase in roadkill probability and count</p>
</section>
<section id="h2-land-use-effects-partially-supported" class="level3">
<h3 class="anchored" data-anchor-id="h2-land-use-effects-partially-supported">H2: Land Use Effects — <strong>PARTIALLY SUPPORTED</strong></h3>
<p>The land use variables show varying effects:</p>
<ul>
<li><strong>Forest/Park</strong>: Likely shows positive association with roadkill (wildlife habitat)</li>
<li><strong>Farmland</strong>: Effects vary by model component (edge habitat vs.&nbsp;open space trade-offs)</li>
<li><strong>Residential</strong>: Negative or non-significant (reduced wildlife)</li>
</ul>
<p>These patterns align with ecological theory about wildlife-vehicle collision hotspots.</p>
</section>
<section id="h3-road-characteristics-supported" class="level3">
<h3 class="anchored" data-anchor-id="h3-road-characteristics-supported">H3: Road Characteristics — <strong>SUPPORTED</strong></h3>
<ul>
<li><strong>Road type</strong>: Major roads show different baseline roadkill rates than minor roads</li>
<li><strong>Speed limit</strong>: Higher speed limits associated with increased collision risk</li>
<li>The offset term confirms longer road segments have proportionally more roadkill</li>
</ul>
</section>
</section>
<section id="policy-implications" class="level2">
<h2 class="anchored" data-anchor-id="policy-implications">Policy Implications</h2>
<p>Our findings suggest several evidence-based mitigation strategies:</p>
<ol type="1">
<li><p><strong>Traffic Management</strong>: Reducing traffic volume or implementing wildlife warning systems on high-traffic corridors near natural habitats</p></li>
<li><p><strong>Targeted Interventions</strong>: Focus mitigation (wildlife crossings, fencing) on:</p>
<ul>
<li>High-traffic roads adjacent to forests/parks</li>
<li>Major highways with speed limits &gt; 80 km/h</li>
<li>Agricultural edge habitats with known wildlife movement</li>
</ul></li>
<li><p><strong>Land Use Planning</strong>: Consider wildlife-vehicle collision risk when approving development near natural areas</p></li>
</ol>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<ol type="1">
<li><strong>Data Coverage</strong>: Analysis limited to roads with traffic monitoring (may not generalize to rural areas)</li>
<li><strong>Species Aggregation</strong>: Roadkill counts combine all species; species-specific models could reveal different patterns</li>
<li><strong>Temporal Variation</strong>: Seasonal and daily patterns not modeled (could be future extension)</li>
<li><strong>Causal Inference</strong>: While DAG guides our analysis, unmeasured confounders (e.g., wildlife population density) may exist</li>
</ol>
</section>
<section id="concluding-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="concluding-thoughts">Concluding Thoughts</h2>
<p>This analysis tackled a challenging question—what drives wildlife-vehicle collisions on Danish roads?—using a statistical framework designed for the peculiarities of roadkill data: massive zero-inflation and overdispersion.</p>
<p><strong>Key Contributions</strong>:</p>
<ol type="1">
<li><strong>Methodological</strong>: We demonstrated how hurdle models handle dual processes (occurrence vs.&nbsp;intensity) in zero-inflated count data</li>
<li><strong>Substantive</strong>: We quantified the effects of traffic, land use, and road characteristics on roadkill risk</li>
<li><strong>Policy-relevant</strong>: We identified actionable levers for reducing wildlife mortality (traffic management, targeted fencing)</li>
</ol>
<p><strong>The Bigger Picture</strong>:</p>
<p>Wildlife-vehicle collisions represent a broader challenge at the intersection of human infrastructure and ecosystem health. As road networks expand globally, understanding these collision dynamics becomes critical for conservation. The statistical approach used here—combining geospatial data integration, causal reasoning (DAGs), and specialized count models—exemplifies modern environmental data science.</p>
<p><strong>Beyond Roadkill</strong>:</p>
<p>The hurdle model framework extends to many zero-inflated ecological phenomena: - Rare species observations in biodiversity surveys - Disease outbreak counts in epidemiology - Extreme weather event frequencies in climate science - Pollution violation counts in environmental monitoring</p>
<p>Wherever zeros dominate your count data and two distinct processes govern occurrence vs.&nbsp;intensity, consider the hurdle model.</p>
<hr>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Data sources: - Global Roadkill Database: https://wildlifeobserver.net/ - OpenStreetMap (via Geofabrik): Roads and land use polygons - Vejdirektoratet (Danish Road Directorate): Traffic counts (AADT)</p>
<p>Key statistical methods: - Zeileis, A., Kleiber, C., &amp; Jackman, S. (2008). Regression models for count data in R. <em>Journal of Statistical Software</em>, 27(8), 1-25. - Mullahy, J. (1986). Specification and testing of some modified count data models. <em>Journal of Econometrics</em>, 33(3), 341-365.</p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{miller2025,
  author = {Miller, Emily},
  title = {Traffic, {Land} {Use,} and {Wildlife-Vehicle} {Collisions} in
    {Denmark}},
  date = {2025-11-29},
  url = {https://rellimylime.github.io/posts/eds222-final/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-miller2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Miller, Emily. 2025. <span>“Traffic, Land Use, and Wildlife-Vehicle
Collisions in Denmark.”</span> November 29, 2025. <a href="https://rellimylime.github.io/posts/eds222-final/">https://rellimylime.github.io/posts/eds222-final/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>